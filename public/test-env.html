<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦Ø© - OrgaFlow36</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap');
        body {
            font-family: 'Cairo', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h1 class="text-3xl font-bold text-indigo-600 mb-6 text-center">
                ğŸ” Ø§Ø®ØªØ¨Ø§Ø± Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦Ø© - OrgaFlow36
            </h1>

            <div class="space-y-4">
                <!-- Test 1: Environment Variables -->
                <div class="border border-gray-200 rounded-lg p-4">
                    <h2 class="text-xl font-semibold mb-3 text-gray-800">
                        1ï¸âƒ£ Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦Ø©
                    </h2>
                    <div id="env-results" class="space-y-2"></div>
                </div>

                <!-- Test 2: Supabase Connection -->
                <div class="border border-gray-200 rounded-lg p-4">
                    <h2 class="text-xl font-semibold mb-3 text-gray-800">
                        2ï¸âƒ£ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Supabase
                    </h2>
                    <button 
                        onclick="testSupabase()" 
                        class="bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700 transition"
                    >
                        Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„
                    </button>
                    <div id="supabase-results" class="mt-3"></div>
                </div>

                <!-- Test 3: Build Info -->
                <div class="border border-gray-200 rounded-lg p-4">
                    <h2 class="text-xl font-semibold mb-3 text-gray-800">
                        3ï¸âƒ£ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¨Ù†Ø§Ø¡
                    </h2>
                    <div id="build-info" class="space-y-2"></div>
                </div>
            </div>

            <div class="mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                <h3 class="font-semibold text-blue-800 mb-2">ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</h3>
                <ul class="list-disc list-inside text-blue-700 space-y-1 text-sm">
                    <li>Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦Ø© "undefined"ØŒ ÙŠØ¬Ø¨ Ø¥Ø¶Ø§ÙØªÙ‡Ø§ ÙÙŠ Netlify</li>
                    <li>ÙŠØ¬Ø¨ Ø£Ù† ØªØ¨Ø¯Ø£ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø¨Ù€ <code class="bg-blue-100 px-1 rounded">VITE_</code></li>
                    <li>Ø¨Ø¹Ø¯ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ØªØºÙŠØ±Ø§ØªØŒ ÙŠØ¬Ø¨ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù†Ø´Ø± (Redeploy)</li>
                </ul>
            </div>
        </div>
    </div>

    <script type="module">
        // Test 1: Check Environment Variables
        function checkEnvVariables() {
            const envResults = document.getElementById('env-results');
            const vars = {
                'VITE_SUPABASE_URL': import.meta.env.VITE_SUPABASE_URL,
                'VITE_SUPABASE_ANON_KEY': import.meta.env.VITE_SUPABASE_ANON_KEY,
                'GEMINI_API_KEY': import.meta.env.GEMINI_API_KEY
            };

            let html = '';
            for (const [key, value] of Object.entries(vars)) {
                const status = value ? 'âœ…' : 'âŒ';
                const statusClass = value ? 'text-green-600' : 'text-red-600';
                const displayValue = value 
                    ? (key.includes('KEY') ? value.substring(0, 20) + '...' : value)
                    : 'undefined';
                
                html += `
                    <div class="flex items-start gap-2">
                        <span class="${statusClass} text-xl">${status}</span>
                        <div class="flex-1">
                            <div class="font-semibold text-gray-700">${key}</div>
                            <div class="text-sm text-gray-600 font-mono break-all">${displayValue}</div>
                        </div>
                    </div>
                `;
            }
            envResults.innerHTML = html;
        }

        // Test 2: Test Supabase Connection
        window.testSupabase = async function() {
            const resultsDiv = document.getElementById('supabase-results');
            resultsDiv.innerHTML = '<div class="text-gray-600">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...</div>';

            const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;
            const supabaseKey = import.meta.env.VITE_SUPABASE_ANON_KEY;

            if (!supabaseUrl || !supabaseKey) {
                resultsDiv.innerHTML = `
                    <div class="text-red-600 font-semibold">
                        âŒ Ù…ØªØºÙŠØ±Ø§Øª Supabase ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©!
                    </div>
                `;
                return;
            }

            try {
                // Import Supabase
                const { createClient } = await import('https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm');
                const supabase = createClient(supabaseUrl, supabaseKey);

                // Test connection by fetching from a table
                const { data, error } = await supabase
                    .from('users')
                    .select('count')
                    .limit(1);

                if (error) {
                    resultsDiv.innerHTML = `
                        <div class="text-red-600">
                            <div class="font-semibold">âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„</div>
                            <div class="text-sm mt-1">Ø§Ù„Ø®Ø·Ø£: ${error.message}</div>
                        </div>
                    `;
                } else {
                    resultsDiv.innerHTML = `
                        <div class="text-green-600 font-semibold">
                            âœ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Supabase Ù†Ø§Ø¬Ø­!
                        </div>
                    `;
                }
            } catch (err) {
                resultsDiv.innerHTML = `
                    <div class="text-red-600">
                        <div class="font-semibold">âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„</div>
                        <div class="text-sm mt-1">${err.message}</div>
                    </div>
                `;
            }
        };

        // Test 3: Build Info
        function showBuildInfo() {
            const buildInfo = document.getElementById('build-info');
            const info = {
                'Mode': import.meta.env.MODE,
                'Base URL': import.meta.env.BASE_URL,
                'Production': import.meta.env.PROD ? 'Yes' : 'No',
                'Development': import.meta.env.DEV ? 'Yes' : 'No'
            };

            let html = '';
            for (const [key, value] of Object.entries(info)) {
                html += `
                    <div class="flex gap-2">
                        <span class="font-semibold text-gray-700">${key}:</span>
                        <span class="text-gray-600">${value}</span>
                    </div>
                `;
            }
            buildInfo.innerHTML = html;
        }

        // Run tests on page load
        checkEnvVariables();
        showBuildInfo();
    </script>
</body>
</html>

