<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸŒ± Seed Data - OrgaFlow</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen p-8">
    <div class="max-w-4xl mx-auto">
        <div class="bg-white rounded-2xl shadow-2xl p-8">
            <h1 class="text-4xl font-bold text-center text-indigo-600 mb-2">ğŸŒ± Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©</h1>
            <p class="text-center text-gray-600 mb-8">Seed Data for OrgaFlow</p>

            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6">
                <p class="text-yellow-800">
                    <strong>âš ï¸ ØªØ­Ø°ÙŠØ±:</strong> Ù‡Ø°Ø§ Ø§Ù„Ø³ÙƒØ±ÙŠØ¨Øª Ø³ÙŠØ¶ÙŠÙ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ø¥Ù„Ù‰ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¹ Ù…Ø±ÙÙ‚Ø§Øª ÙØ¹Ù„ÙŠØ©.
                </p>
            </div>

            <div class="space-y-4 mb-8">
                <div class="flex items-center gap-3 p-4 bg-gray-50 rounded-lg">
                    <span class="text-2xl">ğŸ“‹</span>
                    <div>
                        <h3 class="font-semibold">Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª ÙˆØ§Ù„Ø£Ø¯Ù„Ø©</h3>
                        <p class="text-sm text-gray-600">3 Ø³Ø¬Ù„Ø§Øª Ù…Ø¹ Ù…Ù„ÙØ§Øª PDF</p>
                    </div>
                </div>

                <div class="flex items-center gap-3 p-4 bg-gray-50 rounded-lg">
                    <span class="text-2xl">âœ‰ï¸</span>
                    <div>
                        <h3 class="font-semibold">Ø§Ù„Ù…Ø±Ø§Ø³Ù„Ø§Øª</h3>
                        <p class="text-sm text-gray-600">3 Ø³Ø¬Ù„Ø§Øª (ØµØ§Ø¯Ø± ÙˆÙˆØ§Ø±Ø¯) Ù…Ø¹ Ù…Ù„ÙØ§Øª PDF</p>
                    </div>
                </div>

                <div class="flex items-center gap-3 p-4 bg-gray-50 rounded-lg">
                    <span class="text-2xl">ğŸ¢</span>
                    <div>
                        <h3 class="font-semibold">Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</h3>
                        <p class="text-sm text-gray-600">5 Ø£Ù‚Ø³Ø§Ù…</p>
                    </div>
                </div>

                <div class="flex items-center gap-3 p-4 bg-gray-50 rounded-lg">
                    <span class="text-2xl">ğŸ’°</span>
                    <div>
                        <h3 class="font-semibold">Ø§Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ù…Ø§Ù†Ø­Ø©</h3>
                        <p class="text-sm text-gray-600">3 Ø¬Ù‡Ø§Øª Ù…Ø§Ù†Ø­Ø©</p>
                    </div>
                </div>

                <div class="flex items-center gap-3 p-4 bg-gray-50 rounded-lg">
                    <span class="text-2xl">ğŸ‘¥</span>
                    <div>
                        <h3 class="font-semibold">Ø£Ø¹Ø¶Ø§Ø¡ Ù…Ø¬Ù„Ø³ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h3>
                        <p class="text-sm text-gray-600">5 Ø£Ø¹Ø¶Ø§Ø¡</p>
                    </div>
                </div>
            </div>

            <button
                id="seedBtn"
                onclick="runSeed()"
                class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 px-6 rounded-lg shadow-lg transition-all transform hover:scale-105">
                ğŸš€ Ø¨Ø¯Ø¡ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            </button>

            <div id="output" class="mt-6 p-4 bg-gray-900 text-green-400 rounded-lg font-mono text-sm h-96 overflow-y-auto hidden"></div>
        </div>
    </div>

    <script type="module">
        const { createClient } = supabase;

        // Initialize Supabase client
        const supabaseClient = createClient(
            'https://dihtjatqgwyyuvilacdd.supabase.co',
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRpaHRqYXRxZ3d5eXV2aWxhY2RkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQwMTc0MDMsImV4cCI6MjA3OTU5MzQwM30.Ck7mKYM5g44SF4S3JkIjqpOWx6u582R9KCxqGLaIJ9A'
        );

        function log(message, type = 'info') {
            const output = document.getElementById('output');
            output.classList.remove('hidden');
            const timestamp = new Date().toLocaleTimeString('ar-SA');
            const icon = type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : 'ğŸ“';
            output.innerHTML += `[${timestamp}] ${icon} ${message}\n`;
            output.scrollTop = output.scrollHeight;
        }

        function createSamplePDF(title) {
            const pdfContent = `%PDF-1.4
1 0 obj
<<
/Type /Catalog
/Pages 2 0 R
>>
endobj
2 0 obj
<<
/Type /Pages
/Kids [3 0 R]
/Count 1
>>
endobj
3 0 obj
<<
/Type /Page
/Parent 2 0 R
/Resources <<
/Font <<
/F1 <<
/Type /Font
/Subtype /Type1
/BaseFont /Helvetica
>>
>>
>>
/MediaBox [0 0 612 792]
/Contents 4 0 R
>>
endobj
4 0 obj
<<
/Length 44
>>
stream
BT
/F1 12 Tf
100 700 Td
(${title}) Tj
ET
endstream
endobj
xref
0 5
0000000000 65535 f
0000000009 00000 n
0000000058 00000 n
0000000115 00000 n
0000000317 00000 n
trailer
<<
/Size 5
/Root 1 0 R
>>
startxref
410
%%EOF`;

            return new Blob([pdfContent], { type: 'application/pdf' });
        }

        async function uploadFileToStorage(file, folder, fileName) {
            const filePath = `${folder}/${fileName}`;

            const { data, error } = await supabaseClient.storage
                .from('attachments')
                .upload(filePath, file, {
                    cacheControl: '3600',
                    upsert: true,
                });

            if (error) throw error;

            const { data: { publicUrl } } = supabaseClient.storage
                .from('attachments')
                .getPublicUrl(filePath);

            return publicUrl;
        }

        async function seedPolicyManuals() {
            log('ğŸŒ± Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª ÙˆØ§Ù„Ø£Ø¯Ù„Ø©...');

            const policies = [
                { name: 'Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©', year: '2024', notes: 'Ø³ÙŠØ§Ø³Ø© Ø´Ø§Ù…Ù„Ø© Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©' },
                { name: 'Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©', year: '2024', notes: 'Ø¯Ù„ÙŠÙ„ Ø´Ø§Ù…Ù„ Ù„Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© ÙˆØ§Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠØ©' },
                { name: 'Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª ÙˆØ§Ù„Ø¹Ù‚ÙˆØ¯', year: '2023', notes: 'Ø³ÙŠØ§Ø³Ø© ØªÙ†Ø¸ÙŠÙ… Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª ÙˆØ§Ù„Ø¹Ù‚ÙˆØ¯' },
            ];

            for (const policy of policies) {
                try {
                    const pdfBlob = createSamplePDF(policy.name);
                    const fileName = `${Date.now()}-${policy.name.replace(/\s+/g, '_')}.pdf`;

                    const fileUrl = await uploadFileToStorage(pdfBlob, 'policies', fileName);

                    const { error } = await supabaseClient
                        .from('policy_manuals')
                        .insert([{
                            name: policy.name,
                            year: policy.year,
                            notes: policy.notes,
                            issue_date: new Date().toISOString().split('T')[0],
                            attachment_name: fileName,
                            attachment_url: fileUrl,
                            attachment_type: 'application/pdf'
                        }]);

                    if (error) throw error;
                    log(`ØªÙ…Øª Ø¥Ø¶Ø§ÙØ©: ${policy.name}`, 'success');
                    await new Promise(resolve => setTimeout(resolve, 100)); // Small delay
                } catch (error) {
                    log(`ÙØ´Ù„ Ø¥Ø¶Ø§ÙØ©: ${policy.name} - ${error.message}`, 'error');
                }
            }
        }

        async function seedCorrespondence() {
            log('ğŸŒ± Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø±Ø§Ø³Ù„Ø§Øª...');

            const correspondences = [
                { type: 'Outgoing', title: 'Ø·Ù„Ø¨ ØªÙ…ÙˆÙŠÙ„ Ù…Ø´Ø±ÙˆØ¹', entity: 'ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ®Ø·ÙŠØ·', serialNumber: 'OUT-2024-0001', sequence: 1 },
                { type: 'Incoming', title: 'Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹', entity: 'Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ù…Ø§Ù†Ø­Ø©', serialNumber: 'IN-2024-0001', sequence: 1 },
                { type: 'Outgoing', title: 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠ', entity: 'Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ù…Ø§Ù†Ø­Ø©', serialNumber: 'OUT-2024-0002', sequence: 2 },
            ];

            for (const corr of correspondences) {
                try {
                    const pdfBlob = createSamplePDF(corr.title);
                    const fileName = `${Date.now()}-${corr.serialNumber}.pdf`;

                    const fileUrl = await uploadFileToStorage(pdfBlob, 'correspondence', fileName);

                    const { error } = await supabaseClient
                        .from('correspondence')
                        .insert([{
                            type: corr.type,
                            title: corr.title,
                            entity: corr.entity,
                            date: new Date().toISOString().split('T')[0],
                            serial_number: corr.serialNumber,
                            sequence: corr.sequence,
                            year: 2024,
                            attachment_name: fileName,
                            attachment_url: fileUrl,
                            attachment_type: 'application/pdf'
                        }]);

                    if (error) throw error;
                    log(`ØªÙ…Øª Ø¥Ø¶Ø§ÙØ©: ${corr.title}`, 'success');
                    await new Promise(resolve => setTimeout(resolve, 100));
                } catch (error) {
                    log(`ÙØ´Ù„ Ø¥Ø¶Ø§ÙØ©: ${corr.title} - ${error.message}`, 'error');
                }
            }
        }

        async function seedDepartments() {
            log('ğŸŒ± Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ù‚Ø³Ø§Ù…...');

            const departments = [
                { name_ar: 'Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø©', name_en: 'General Management' },
                { name_ar: 'Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©', name_en: 'Human Resources' },
                { name_ar: 'Ø§Ù„Ù…Ø§Ù„ÙŠØ© ÙˆØ§Ù„Ù…Ø­Ø§Ø³Ø¨Ø©', name_en: 'Finance and Accounting' },
                { name_ar: 'Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹', name_en: 'Projects' },
                { name_ar: 'Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª', name_en: 'Procurement' },
            ];

            for (const dept of departments) {
                try {
                    const { error } = await supabaseClient
                        .from('departments')
                        .insert([dept]);

                    if (error) throw error;
                    log(`ØªÙ…Øª Ø¥Ø¶Ø§ÙØ©: ${dept.name_ar}`, 'success');
                } catch (error) {
                    log(`ÙØ´Ù„ Ø¥Ø¶Ø§ÙØ©: ${dept.name_ar} - ${error.message}`, 'error');
                }
            }
        }

        async function seedDonors() {
            log('ğŸŒ± Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ù…Ø§Ù†Ø­Ø©...');

            const donors = [
                { name_ar: 'Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø¯ÙˆÙ„ÙŠ', name_en: 'World Bank', country: 'USA', contact_person: 'John Smith', email: 'john@worldbank.org', phone: '+1234567890' },
                { name_ar: 'Ø§Ù„Ø§ØªØ­Ø§Ø¯ Ø§Ù„Ø£ÙˆØ±ÙˆØ¨ÙŠ', name_en: 'European Union', country: 'Belgium', contact_person: 'Marie Dupont', email: 'marie@eu.org', phone: '+32123456789' },
                { name_ar: 'Ø§Ù„ÙˆÙƒØ§Ù„Ø© Ø§Ù„Ø£Ù…Ø±ÙŠÙƒÙŠØ© Ù„Ù„ØªÙ†Ù…ÙŠØ©', name_en: 'USAID', country: 'USA', contact_person: 'Sarah Johnson', email: 'sarah@usaid.gov', phone: '+1987654321' },
            ];

            for (const donor of donors) {
                try {
                    const { error } = await supabaseClient
                        .from('donors')
                        .insert([donor]);

                    if (error) throw error;
                    log(`ØªÙ…Øª Ø¥Ø¶Ø§ÙØ©: ${donor.name_ar}`, 'success');
                } catch (error) {
                    log(`ÙØ´Ù„ Ø¥Ø¶Ø§ÙØ©: ${donor.name_ar} - ${error.message}`, 'error');
                }
            }
        }

        async function seedBoardMembers() {
            log('ğŸŒ± Ø¥Ø¶Ø§ÙØ© Ø£Ø¹Ø¶Ø§Ø¡ Ù…Ø¬Ù„Ø³ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©...');

            const members = [
                { full_name: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ', id_number: '1234567890', nationality: 'Ø³Ø¹ÙˆØ¯ÙŠ', position: 'Ø±Ø¦ÙŠØ³ Ù…Ø¬Ù„Ø³ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©', phone: '0501234567', email: 'ahmed@example.com' },
                { full_name: 'ÙØ§Ø·Ù…Ø© Ø­Ø³Ù†', id_number: '0987654321', nationality: 'Ø³Ø¹ÙˆØ¯ÙŠØ©', position: 'Ù†Ø§Ø¦Ø¨ Ø§Ù„Ø±Ø¦ÙŠØ³', phone: '0509876543', email: 'fatima@example.com' },
                { full_name: 'Ø®Ø§Ù„Ø¯ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡', id_number: '1122334455', nationality: 'Ø³Ø¹ÙˆØ¯ÙŠ', position: 'Ø¹Ø¶Ùˆ', phone: '0501122334', email: 'khaled@example.com' },
                { full_name: 'Ù†ÙˆØ±Ø© Ø³Ø¹ÙŠØ¯', id_number: '5544332211', nationality: 'Ø³Ø¹ÙˆØ¯ÙŠØ©', position: 'Ø¹Ø¶Ùˆ', phone: '0505544332', email: 'noura@example.com' },
                { full_name: 'Ø¹Ù…Ø± ÙŠÙˆØ³Ù', id_number: '6677889900', nationality: 'Ø³Ø¹ÙˆØ¯ÙŠ', position: 'Ø¹Ø¶Ùˆ', phone: '0506677889', email: 'omar@example.com' },
            ];

            for (const member of members) {
                try {
                    const { error } = await supabaseClient
                        .from('master_board_members')
                        .insert([member]);

                    if (error) throw error;
                    log(`ØªÙ…Øª Ø¥Ø¶Ø§ÙØ©: ${member.full_name}`, 'success');
                } catch (error) {
                    log(`ÙØ´Ù„ Ø¥Ø¶Ø§ÙØ©: ${member.full_name} - ${error.message}`, 'error');
                }
            }
        }

        window.runSeed = async function() {
            const btn = document.getElementById('seedBtn');
            btn.disabled = true;
            btn.textContent = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø¶Ø§ÙØ©...';

            const output = document.getElementById('output');
            output.innerHTML = '';
            output.classList.remove('hidden');

            try {
                log('ğŸš€ Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...\n');

                await seedPolicyManuals();
                log('');

                await seedCorrespondence();
                log('');

                await seedDepartments();
                log('');

                await seedDonors();
                log('');

                await seedBoardMembers();
                log('');

                log('âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                btn.textContent = 'âœ… ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¬Ø§Ø­';
                btn.classList.remove('bg-indigo-600', 'hover:bg-indigo-700');
                btn.classList.add('bg-green-600');
            } catch (error) {
                log(`âŒ ÙØ´Ù„Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ©: ${error.message}`, 'error');
                btn.disabled = false;
                btn.textContent = 'ğŸš€ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©';
            }
        };
    </script>
</body>
</html>