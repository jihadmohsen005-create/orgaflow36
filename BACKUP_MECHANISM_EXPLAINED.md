# ๐ ุดุฑุญ ุชูุตููู ูุขููุฉ ุนูู ูุธุงู ุงููุณุฎ ุงูุงุญุชูุงุทู

## 1๏ธโฃ ุนูููุฉ ุงูุชุตุฏูุฑ (Export) - ุงูุดุฑุญ ุงูุชูุตููู

### โ **ูุนูุ ูุชู ุชุญููู ุงูุจูุงูุงุช ุงููุนููุฉ ุงููุงููุฉ ูู Supabase!**

### ๐ **ููู ุชุนูู ุนูููุฉ ุงูุชุตุฏูุฑ ุฎุทูุฉ ุจุฎุทูุฉ:**

```typescript
// ุงูุฎุทูุฉ 1: ุฅูุดุงุก ูุงุฆู ูุงุฑุบ ูุชุฎุฒูู ุงูุจูุงูุงุช
const backup: Record<string, any[]> = {};

// ุงูุฎุทูุฉ 2: ุงููุฑูุฑ ุนูู ูู ุฌุฏูู ูู ุงูู 84 ุฌุฏูู
for (const tableName of TABLES_TO_BACKUP) {
  
  // ุงูุฎุทูุฉ 3: ุฌูุจ ุฌููุน ุงูุจูุงูุงุช ูู Supabase
  const { data, error } = await supabase
    .from(tableName)        // ุงุณู ุงูุฌุฏูู (ูุซูุงู: 'users')
    .select('*');           // ุฌูุจ ุฌููุน ุงูุฃุนูุฏุฉ ูุงูุณุฌูุงุช
  
  // ุงูุฎุทูุฉ 4: ุญูุธ ุงูุจูุงูุงุช ูู ุงููุงุฆู
  backup[tableName] = data || [];
}

// ุงูุฎุทูุฉ 5: ุฅูุดุงุก ููู JSON
const backupData = {
  metadata: {
    exportDate: "2025-01-25T10:30:00.000Z",
    version: "1.0",
    tables: 84
  },
  data: backup  // ุฌููุน ุงูุจูุงูุงุช ูู ุฌููุน ุงูุฌุฏุงูู
};

// ุงูุฎุทูุฉ 6: ุชุญููู ุฅูู JSON ูุชุญูููู
const blob = new Blob([JSON.stringify(backupData, null, 2)]);
// ุชุญููู ุงูููู ูููุณุชุฎุฏู
```

### ๐ฏ **ุงูุฅุฌุงุจุงุช ุงููุญุฏุฏุฉ:**

#### **ุงูุณุคุงู: ูู ูุชู ุชุญููู ุงูุจูุงูุงุช ุงููุนููุฉุ**
โ **ูุนูุ 100%!** ูุชู ุชุญููู:
- โ ุฌููุน ุงูุณุฌูุงุช (Rows) ูู ูู ุฌุฏูู
- โ ุฌููุน ุงูุญููู (Columns) ูู ูู ุณุฌู
- โ ุฌููุน ุงูููู ุงููุนููุฉ (ุงูุจูุงูุงุช ุงูุญููููุฉ)

**ูุซุงู ุนููู:**
```typescript
// ุนูุฏ ุชุตุฏูุฑ ุฌุฏูู 'users'ุ ูุชู ุฌูุจ:
await supabase.from('users').select('*');

// ุงููุชูุฌุฉ:
[
  {
    id: "11111111-1111-1111-1111-111111111111",
    username: "director",
    password: "123",
    role_id: "exec_director",
    name: "Executive Director",
    created_at: "2025-01-25T08:00:00.000Z"
  },
  {
    id: "22222222-2222-2222-2222-222222222222",
    username: "finance",
    password: "123",
    role_id: "finance_manager",
    name: "Finance Manager",
    created_at: "2025-01-25T08:00:00.000Z"
  },
  // ... ุฌููุน ุงููุณุชุฎุฏููู ุงูุขุฎุฑูู
]
```

#### **ุงูุณุคุงู: ูู ูุชู ุชุตุฏูุฑ ุงูุจููุฉ ููุท (Schema)ุ**
โ **ูุง!** ูุง ูุชู ุชุตุฏูุฑ ุงูุจููุฉ (Schema).
- โ ูุง ูุชู ุชุตุฏูุฑ ุชุนุฑููุงุช ุงูุฌุฏุงูู (CREATE TABLE)
- โ ูุง ูุชู ุชุตุฏูุฑ ุงููููุฏ (Constraints)
- โ ูุง ูุชู ุชุตุฏูุฑ ุงูููุงุฑุณ (Indexes)
- โ ูุชู ุชุตุฏูุฑ **ุงูุจูุงูุงุช ููุท** (Data Only)

**ููุงุฐุงุ** ูุฃู ุงูุจููุฉ ููุฌูุฏุฉ ุจุงููุนู ูู ูููุงุช SQL:
- `supabase/schema.sql`
- `supabase/schema_part2.sql`
- `supabase/schema_part3.sql`

#### **ุงูุณุคุงู: ูู ุฃูู ูุชู ุฌูุจ ุงูุจูุงูุงุชุ**
โ **ูุจุงุดุฑุฉ ูู ูุงุนุฏุฉ ุจูุงูุงุช Supabase ุงูุณุญุงุจูุฉ!**

```typescript
// ุงูุงุชุตุงู ุงููุจุงุดุฑ ุจู Supabase
import { supabase } from '../lib/supabase';

// supabase ูุดูุฑ ุฅูู:
// https://dihtjatqgwyyuvilacdd.supabase.co
```

**ููุณ ูู:**
- โ ุฐุงูุฑุฉ ุงูุชุทุจูู ุงููุญููุฉ
- โ localStorage
- โ sessionStorage
- โ ูููุงุช ูุญููุฉ

---

## 2๏ธโฃ ูุญุชูู ููู JSON - ุงูุดุฑุญ ุงูุชูุตููู

### ๐ **ุจููุฉ ููู JSON ุงููุงูู:**

```json
{
  "metadata": {
    "exportDate": "2025-01-25T10:30:00.000Z",
    "version": "1.0",
    "tables": 84
  },
  "data": {
    "users": [
      {
        "id": "11111111-1111-1111-1111-111111111111",
        "username": "director",
        "password": "123",
        "role_id": "exec_director",
        "name": "Executive Director",
        "created_at": "2025-01-25T08:00:00.000Z"
      },
      {
        "id": "22222222-2222-2222-2222-222222222222",
        "username": "finance",
        "password": "123",
        "role_id": "finance_manager",
        "name": "Finance Manager",
        "created_at": "2025-01-25T08:00:00.000Z"
      }
    ],
    "roles": [
      {
        "id": "exec_director",
        "name_ar": "ูุฏูุฑ ุชูููุฐู",
        "name_en": "Executive Director",
        "created_at": "2025-01-25T08:00:00.000Z"
      },
      {
        "id": "finance_manager",
        "name_ar": "ูุฏูุฑ ูุงูู",
        "name_en": "Finance Manager",
        "created_at": "2025-01-25T08:00:00.000Z"
      }
    ],
    "suppliers": [
      {
        "id": "00011111-1111-1111-1111-111111111111",
        "name_ar": "ุดุฑูุฉ ุฃููุง ููุชูุฑูุฏุงุช",
        "name_en": "Alpha Supplies Co.",
        "phone": "0501234567",
        "email": "info@alpha.com",
        "type_id": "1f5e6ed0-252a-492f-83d1-289b5ef645b9",
        "business_id": "021152f1-3c1a-4dfc-bbfb-9699d105c6f4"
      }
    ],
    "items": [
      {
        "id": "i0001111-1111-1111-1111-111111111111",
        "category_id": "f759bd69-2228-4df4-badd-d5bfa92db0c9",
        "name_ar": "ุฌูุงุฒ ุญุงุณูุจ ูุญููู",
        "name_en": "Laptop Computer",
        "unit": "ูุทุนุฉ",
        "estimated_price": 1000,
        "currency": "USD"
      }
    ],
    "projects": [...],
    "purchase_requests": [...],
    "contracts": [...],
    // ... 84 ุฌุฏูู ุขุฎุฑ
  }
}
```

### ๐ฏ **ุงูุฅุฌุงุจุงุช ุงููุญุฏุฏุฉ:**

#### **ุงูุณุคุงู: ูุง ูุญุชูู ููู JSONุ**
โ **ูุญุชูู ุนูู:**
1. **Metadata (ูุนูููุงุช ูุตููุฉ):**
   - ุชุงุฑูุฎ ุงูุชุตุฏูุฑ
   - ุฑูู ุงูุฅุตุฏุงุฑ
   - ุนุฏุฏ ุงูุฌุฏุงูู

2. **Data (ุงูุจูุงูุงุช ุงููุนููุฉ):**
   - ุฌููุน ุงูุณุฌูุงุช ูู ุฌููุน ุงูุฌุฏุงูู (84 ุฌุฏูู)
   - ุฌููุน ุงูุญููู ููู ุณุฌู
   - ุงูููู ุงูุญููููุฉ ุงููุงููุฉ

#### **ุงูุณุคุงู: ูู ูุญุชูู ุนูู ุงูุจูุงูุงุช ุงููุนููุฉุ**
โ **ูุนูุ 100%!** ุงูุจูุงูุงุช ุงููุนููุฉ ุงููุงููุฉ ูู Supabase

#### **ุงูุณุคุงู: ูุง ูู ุญุฌู ุงููููุ**
๐ **ูุนุชูุฏ ุนูู ุญุฌู ุงูุจูุงูุงุช:**
- ูุงุนุฏุฉ ุจูุงูุงุช ุตุบูุฑุฉ (100 ุณุฌู): ~50 KB
- ูุงุนุฏุฉ ุจูุงูุงุช ูุชูุณุทุฉ (1000 ุณุฌู): ~500 KB
- ูุงุนุฏุฉ ุจูุงูุงุช ูุจูุฑุฉ (10,000 ุณุฌู): ~5 MB
- ูุงุนุฏุฉ ุจูุงูุงุช ุถุฎูุฉ (100,000 ุณุฌู): ~50 MB

---

## 3๏ธโฃ ุนูููุฉ ุงูุงุณุชูุฑุงุฏ (Import) - ุงูุดุฑุญ ุงูุชูุตููู

### ๐ค **ููู ุชุนูู ุนูููุฉ ุงูุงุณุชูุฑุงุฏ:**

```typescript
export const importDatabaseBackup = async (file: File): Promise<void> => {
  // ุงูุฎุทูุฉ 1: ูุฑุงุกุฉ ููู JSON
  const fileContent = await file.text();
  const backupData = JSON.parse(fileContent);
  
  // ุงูุฎุทูุฉ 2: ุงูุชุญูู ูู ุตุญุฉ ุงูููู
  if (!backupData.metadata || !backupData.data) {
    throw new Error('ููู ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ ุบูุฑ ุตุงูุญ');
  }
  
  // ุงูุฎุทูุฉ 3: ุงููุฑูุฑ ุนูู ูู ุฌุฏูู
  for (const tableName of TABLES_TO_BACKUP) {
    const tableData = backupData.data[tableName];
    
    // ุงูุฎุทูุฉ 4: ุฑูุน ุงูุจูุงูุงุช ุฅูู Supabase
    const { error } = await supabase
      .from(tableName)
      .upsert(tableData, { onConflict: 'id' });
  }
};
```

### ๐ฏ **ุงูุฅุฌุงุจุงุช ุงููุญุฏุฏุฉ:**

#### **ุงูุณุคุงู: ูู ูุชู ุฑูุน ุงูุจูุงูุงุช ูุจุงุดุฑุฉ ุฅูู Supabaseุ**
โ **ูุนูุ ูุจุงุดุฑุฉ!**

```typescript
// ูุชู ุงูุฑูุน ูุจุงุดุฑุฉ ุฅูู:
// https://dihtjatqgwyyuvilacdd.supabase.co

await supabase.from('users').upsert(userData);
```

#### **ุงูุณุคุงู: ููู ูุชุนุงูู ูุน ุงูุณุฌูุงุช ุงูููุฑุฑุฉุ**
โ **ูุณุชุฎุฏู UPSERT (Update + Insert):**

```typescript
.upsert(tableData, { onConflict: 'id' })
```

**ูุนูู ุฐูู:**
- โ ุฅุฐุง ูุงู ุงูุณุฌู ููุฌูุฏ (ููุณ ุงูู ID) โ **ูุชู ุงูุชุญุฏูุซ**
- โ ุฅุฐุง ูุงู ุงูุณุฌู ุบูุฑ ููุฌูุฏ โ **ูุชู ุงูุฅุฏุฑุงุฌ**

**ูุซุงู ุนููู:**
```typescript
// ุงูุจูุงูุงุช ุงูููุฌูุฏุฉ ูู Supabase:
{
  id: "11111111-1111-1111-1111-111111111111",
  username: "director",
  name: "Old Name"
}

// ุงูุจูุงูุงุช ูู ููู ุงูุงุณุชูุฑุงุฏ:
{
  id: "11111111-1111-1111-1111-111111111111",
  username: "director",
  name: "New Name"
}

// ุงููุชูุฌุฉ ุจุนุฏ ุงูุงุณุชูุฑุงุฏ:
{
  id: "11111111-1111-1111-1111-111111111111",
  username: "director",
  name: "New Name"  // โ ุชู ุงูุชุญุฏูุซ
}
```

#### **ุงูุณุคุงู: ูู ูููู ุงุณุชุฎุฏุงู ููู ูู ุจูุฆุฉ ุฃุฎุฑูุ**
โ **ูุนูุ ุจุดุฑูุท:**

**โ ูุนูู ุฅุฐุง:**
- ุงูุจููุฉ (Schema) ูุชุทุงุจูุฉ ูู ุงูุจูุฆุชูู
- ุงูุฌุฏุงูู ููุฌูุฏุฉ ูู ุงูุจูุฆุฉ ุงููุณุชูุฏูุฉ
- ุฃุณูุงุก ุงูุฃุนูุฏุฉ ูุชุทุงุจูุฉ

**โ ูุง ูุนูู ุฅุฐุง:**
- ุงูุจููุฉ ูุฎุชููุฉ
- ุงูุฌุฏุงูู ุบูุฑ ููุฌูุฏุฉ
- ุฃุณูุงุก ุงูุฃุนูุฏุฉ ูุฎุชููุฉ

**ูุซุงู:**
```
ุงูุจูุฆุฉ A (Production):
- 84 ุฌุฏูู
- schema.sql v1.0

ุงูุจูุฆุฉ B (Development):
- 84 ุฌุฏูู
- schema.sql v1.0

โ ูููู ููู ุงูุจูุงูุงุช ุจููููุง
```

---

## ๐ ูุซุงู ุนููู ูุงูู

### **ุณููุงุฑูู: ุชุตุฏูุฑ ูุงุณุชูุฑุงุฏ ุจูุงูุงุช ุงููุณุชุฎุฏููู**

#### **1. ุงูุชุตุฏูุฑ:**
```typescript
// ุงููุณุชุฎุฏู ูุถุบุท "ุชุตุฏูุฑ"
await exportDatabaseBackup();

// ูุง ูุญุฏุซ ุฎูู ุงูููุงููุณ:
const users = await supabase.from('users').select('*');
// ุงููุชูุฌุฉ: 5 ูุณุชุฎุฏููู

const roles = await supabase.from('roles').select('*');
// ุงููุชูุฌุฉ: 9 ุฃุฏูุงุฑ

// ... 82 ุฌุฏูู ุขุฎุฑ

// ูุชู ุญูุธ ูู ุดูุก ูู ููู JSON
```

#### **2. ูุญุชูู ุงูููู:**
```json
{
  "metadata": {
    "exportDate": "2025-01-25T10:30:00.000Z",
    "version": "1.0",
    "tables": 84
  },
  "data": {
    "users": [5 ูุณุชุฎุฏููู],
    "roles": [9 ุฃุฏูุงุฑ],
    "suppliers": [3 ููุฑุฏูู],
    // ... 81 ุฌุฏูู ุขุฎุฑ
  }
}
```

#### **3. ุงูุงุณุชูุฑุงุฏ:**
```typescript
// ุงููุณุชุฎุฏู ูุฎุชุงุฑ ุงูููู ููุถุบุท "ุงุณุชูุฑุงุฏ"
await importDatabaseBackup(file);

// ูุง ูุญุฏุซ:
await supabase.from('users').upsert([5 ูุณุชุฎุฏููู]);
await supabase.from('roles').upsert([9 ุฃุฏูุงุฑ]);
// ... 82 ุฌุฏูู ุขุฎุฑ

// ุงููุชูุฌุฉ: ุฌููุน ุงูุจูุงูุงุช ูู Supabase
```

---

## โ๏ธ ููุงุญุธุงุช ูููุฉ

### **ุงูุฃูุงู:**
- ๐ ุงูุจูุงูุงุช ุชูุชูู ุนุจุฑ HTTPS
- ๐ ูุชุทูุจ ููุงุชูุญ Supabase ุตุญูุญุฉ
- ๐ ูุชุทูุจ ุตูุงุญูุงุช ููุงุณุจุฉ

### **ุงูุฃุฏุงุก:**
- โฑ๏ธ ุงูุชุตุฏูุฑ: ~5-10 ุซูุงูู (84 ุงุณุชุนูุงู)
- โฑ๏ธ ุงูุงุณุชูุฑุงุฏ: ~10-20 ุซุงููุฉ (84 ุนูููุฉ upsert)

### **ุงููููุฏ:**
- ๐ ุญุฌู ุงูููู ูุญุฏูุฏ ุจุฐุงูุฑุฉ ุงููุชุตูุญ
- ๐ ุนุฏุฏ ุงูุณุฌูุงุช ูุญุฏูุฏ ุจุญุฏูุฏ Supabase API

---

**ูู ูุฐุง ูุงุถุญ ุงูุขูุ** ๐ฏ

